---
title: 记一次解决Kafka消息堆积故障
date: 2019-03-06 08:58:36
tags:
keywords: Kafka, Kafka消息堆积, Kafka故障
---

## 故障描述

由于系统并没有任何异常，所以都没有仔细关注过相关的数据。最近在打开管理后台的监控界面的时候，发现消息堆积达到三百多万条。


## 排查过程

首先怀疑是不是后台监控界面的数据返回异常，随即登录访问kafka的manage界面，确定消息堆积情况属实。

随即检查生产系统，发现生产系统正常，即系统在正常消费，对比相关消息时间戳，发现也并不存在消息消费速度小于生产速度的情况。

在仔细检查kafka管理web界面的时候发现，消费者中有几个异常的消费者，名字都是 console-consumer-xx，这个引起了怀疑，系统中应该不存在以此命名的消费者，以这个命名方式首先想到的就是kafka的cli工具。仔细检查该消费者，发现所堆积的消息全部在该消费组里面。


## 解决

在确认该消费者只是之前拿来连接测试，并无实际作用后，使用kafka命令行工具,执行以下命令：

``` bash
kafka-consumer-groups.sh  --bootstrap-server your_bootstrap_ips  --delete --group  your_group_name
```

删除后再次检查，消息堆积指标恢复正常。


## 总结

Kafka 消费者分组机制